using System;using Microsoft.Extensions.Options;namespace Khaos.Metrics.Core.Tests.Infrastructure;internal sealed class TestOptionsMonitor : IOptionsMonitor<MonitoringOptions>{    private MonitoringOptions _current;    private event Action<MonitoringOptions, string>? _listeners;    public TestOptionsMonitor(MonitoringOptions options)    {        _current = options;    }    public MonitoringOptions CurrentValue => _current;    public MonitoringOptions Get(string? name) => _current;    public IDisposable OnChange(Action<MonitoringOptions, string> listener)    {        _listeners += listener;        return new Subscription(() => _listeners -= listener);    }    public void Update(MonitoringOptions options)    {        _current = options;        _listeners?.Invoke(options, string.Empty);    }    private sealed class Subscription : IDisposable    {        private readonly Action _dispose;        public Subscription(Action dispose) => _dispose = dispose;        public void Dispose() => _dispose();    }}
