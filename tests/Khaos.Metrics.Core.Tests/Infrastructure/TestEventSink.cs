using System.Collections.Concurrent;namespace Khaos.Metrics.Core.Tests.Infrastructure;internal sealed class TestEventSink : IOperationEventSink{    private readonly ConcurrentQueue<OperationCompletedContext> _events = new();    private readonly Action<OperationCompletedContext>? _callback;    public TestEventSink(Action<OperationCompletedContext>? callback = null)    {        _callback = callback;    }    public int Count => _events.Count;    public IReadOnlyCollection<OperationCompletedContext> Events => _events.ToArray();    public void OnOperationCompleted(OperationCompletedContext context)    {        _events.Enqueue(context);        _callback?.Invoke(context);    }}
