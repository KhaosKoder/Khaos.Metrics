using System;using System.Linq;using System.Threading.Tasks;using Khaos.Metrics.Core.Tests.Infrastructure;namespace Khaos.Metrics.Core.Tests;public class SamplingTests{    [Fact]    public void SamplingRateSkipsEvents()    {        var options = new MonitoringOptions        {            SamplingRate = 2,            EventDispatchMode = EventDispatchMode.Inline        };        var sink = new TestEventSink();        using var engine = new MonitoringEngine(new TestOptionsMonitor(options), new[] { sink });        var clock = new TestClock(DateTimeOffset.UtcNow);        var monitor = new OperationMonitor(engine, clock, new TestOptionsMonitor(options));        for (var i = 0; i < 5; i++)        {            var scope = monitor.Begin("sampled");            clock.Advance(TimeSpan.FromMilliseconds(1));            scope.Dispose();        }        Assert.Equal(5, engine.CaptureSnapshots().Single().TotalCount);        Assert.True(sink.Events.Count <= 3);    }}
