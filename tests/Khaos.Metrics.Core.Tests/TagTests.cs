using System;using System.Collections.Generic;using Khaos.Metrics.Core.Tests.Infrastructure;namespace Khaos.Metrics.Core.Tests;public class TagTests{    [Fact]    public void TagsAreTrimmedAndLimited()    {        var options = new MonitoringOptions        {            MaxTagsPerOperation = 1,            MaxTagKeyLength = 3,            MaxTagValueLength = 5,            EventDispatchMode = EventDispatchMode.Inline        };        var recorded = new List<OperationCompletedContext>();        var sink = new TestEventSink(ctx => recorded.Add(ctx));        using var engine = new MonitoringEngine(new TestOptionsMonitor(options), new[] { sink });        var clock = new TestClock(DateTimeOffset.UtcNow);        var monitor = new OperationMonitor(engine, clock, new TestOptionsMonitor(options));        var tags = new OperationTags(new Dictionary<string, string>        {            ["VeryLongKey"] = "123456789",            ["Extra"] = "Ignored"        });        var scope = monitor.Begin("tagged", tags);        clock.Advance(TimeSpan.FromMilliseconds(1));        scope.Dispose();        var ctx = Assert.Single(recorded);        var tag = Assert.Single(ctx.Tags!);        Assert.Equal("Ver", tag.Key);        Assert.Equal("12345", tag.Value);    }}
