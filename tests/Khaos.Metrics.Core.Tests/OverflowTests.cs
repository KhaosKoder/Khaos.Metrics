using System;using System.Linq;using Khaos.Metrics.Core.Tests.Infrastructure;namespace Khaos.Metrics.Core.Tests;public class OverflowTests{    [Fact]    public void DropNewPolicyPreventsAdditionalOperations()    {        var options = new MonitoringOptions        {            MaxOperationCount = 1,            OverflowPolicy = OperationOverflowPolicy.DropNew,            EventDispatchMode = EventDispatchMode.Inline        };        using var engine = new MonitoringEngine(new TestOptionsMonitor(options), Array.Empty<IOperationEventSink>());        var clock = new TestClock(DateTimeOffset.UtcNow);        var monitor = new OperationMonitor(engine, clock, new TestOptionsMonitor(options));        var scope1 = monitor.Begin("op1");        clock.Advance(TimeSpan.FromMilliseconds(2));        scope1.Dispose();        var scope2 = monitor.Begin("op2");        clock.Advance(TimeSpan.FromMilliseconds(2));        scope2.Dispose();        var snapshots = engine.CaptureSnapshots().ToList();        Assert.Single(snapshots);        Assert.Equal("op1", snapshots[0].Name);    }}
